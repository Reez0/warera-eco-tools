<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon_io/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon_io/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon_io/favicon-16x16.png') }}">
    <title>Warera Eco Tools</title>
</head>
<body>
        <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="loading-text">Loading...</p>
            <p class="loading-subtext">This may take a few moments</p>
        </div>
    </div>
    <div class="container">


        <header>
            <h1>Warera Eco Tools</h1>
            <p class="subtitle">Optimize your resource production and maximize profits</p>
        </header>

<div class="optimal-hero">
    <div class="optimal-label">üìà Market Trends</div>
    <small style="letter-spacing: 0.1em;color: #666;display: block;margin-bottom: 24px;">7-day market trends, and trading activity across all resources</small>
    
    <div class="market-trends-grid">
        {% for item in market_data %}
        <div class="market-card {% if item == winner %}green-border{% elif item == loser %}red-border{% endif %}">
            <div class="market-card-header">
                <img
                    src="{{ url_for('static', filename=item_icons[item.item]) }}"
                    alt="{{ item.item }}"
                    title="{{ item.item|replace('_', ' ')|title }}"
                    class="market-icon"
                >
            </div>
            <div class="market-stats">
                <div class="market-stat">
                    <span class="market-stat-label">7-day Price change</span>
                    <span class="market-stat-value {% if item['price_change_pct_7day'] > 0 %}green{% else %}red{% endif %}">
                        {% if item['price_change_pct_7day'] > 0 %}+{% endif %}{{ "%.2f"|format(item['price_change_pct_7day']) }}%
                    </span>
                </div>
                <div class="market-stat">
                    <span class="market-stat-label">Average daily Trades</span>
                    <span class="market-stat-value">{{ "{:,.0f}".format(item.avg_daily_transactions) }}</span>
                </div>
                <div class="market-stat">
                    <span class="market-stat-label">Average daily Volume</span>
                    <span class="market-stat-value">{{ "{:,.0f}".format(item.avg_daily_quantity) }} units</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
                <div style="height: 0.9px;width: 100%;background-color: rgb(132, 132, 132);/*! padding: 5px; *//*! margin: px; */margin-top: 2%;margin-bottom: 2%;"></div>
            <div class="optimal-label">‚öôÔ∏è View company and employee breakdown</div>
            <div class="optimal-input-group">
                <input type="text" class="optimal-input" placeholder="Enter a player id or warera player profile url" id="playerInput">
                <button id="getProfileData" class="btn-soft">Get profile data</button>
            </div>
</div>

        <div class="countries-section">
            <h2>Countries <small>Click row to view</small></h2>
            <table id="countryTable" class="display nowrap">
                <thead>
                    <tr>
                        <th>Country</th>
                        <th>Specialization</th>
                        <th>Income Tax (%)</th>
                        <th>Production Bonus (%)</th>
                        <th>Found Deposit</th>
                        <th>Max possible Production Bonus</th>
                    </tr>
                </thead>
                <tbody>
                    {% for country in data %}
                    <tr class="{{'max-bonus' if country.max_bonus_applies.value}}" onclick="window.open('https://app.warera.io/country/{{ country.country_id }}', '_blank').focus();">
                        <td>{{ country.name }}</td>
                        <td>
                            <img
                                src="{{ url_for('static', filename=item_icons[country.specialization]) }}"
                                alt="{{ country.specialization }}"
                                title="{{ country.specialization }}"
                            >
                        </td>
                        <td>{{ country.taxes.income }}%</td>
                        <td>{{ country.production_bonus }}%</td>
                        <td>
                            {%if country.deposits%}
                            {% set max_deposits = 5 %}
                            {% for deposit in country.deposits[:max_deposits] %}
                                <img
                                    src="{{ url_for('static', filename=item_icons[deposit.deposit_type]) }}"
                                    alt="{{ deposit.deposit_type }}"
                                    title="{{ deposit.deposit_type }}"
                                >
                            {%endfor%}
                            {% if country.deposits|length > max_deposits %}
                                <small style="font-style: italic;">and {{ country.deposits|length - max_deposits }} others</small>
                            {% endif %}
                            {% else %}
                                No deposit found
                            {% endif %}
                        </td>
                        <td>
                            {% if country.max_bonus_applies.value %}
                                {{ country.max_bonus_applies.value }}%
                            {% else %}
                                30%
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="stats-grid">
            <!-- Market Prices -->
            <div class="stat-card">
                <h3>üí∞ Market Pricing (7 days) <small>Click to view</small></h3>
                <div class="stat-list">
                    {% for market in market_data %}
                    <div class="stat-item pointer" onclick="window.open('https://app.warera.io/market/trading?itemCode={{ market.item }}', '_blank').focus();">
                        <span class="stat-label">
                            <img
                                src="{{ url_for('static', filename=item_icons[market.item]) }}"
                                alt="{{ market.item }}"
                                title="{{ market.item }}"
                            >
                        </span>
                        <div class="price-group">
                            <div class="price-row">
                                <span class="price-label">Price change:</span>
                                <span class="buy-price {{ 'green' if market.price_change_pct_7day >= 0 else 'red' }}">
                                    {{ ('+' if market.price_change_pct_7day >= 0 else '') ~ market.price_change_pct_7day }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Deposit Count -->
            <div class="stat-card">
                <h3>‚õèÔ∏è Resource Deposit Count</h3>
                <div class="stat-list">
                    {% for resource, count in deposit_count.items() %}
                    <div class="stat-item">
                        <span class="stat-label">
                            <img
                                src="{{ url_for('static', filename=item_icons[resource]) }}"
                                alt="{{ resource }}"
                                title="{{ resource }}"
                            >
                            {{ resource }}
                        </span>
                        <span class="stat-value">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>



        <footer>
            <p>Warera Eco Tools</p>
            <p>Suggestions? Find me <a href="https://app.warera.io/user/68e563d741440cb58b76a7b9">here</a></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>