{% extends "partials/base.html" %}
{% block body %}   
    <!-- Header -->
     <div class="max-w-7xl mx-auto px-5">
<header class="py-6 border-b border-dark-border mb-8">
  <div class="flex flex-col gap-6">
            <a href="/app/" class="text-dark-text-muted hover:text-dark-text transition-colors text-sm uppercase tracking-wide">
            ‚Üê back to dashboard
        </a>
    <div class="flex items-center gap-4">
      {% if data.avatar %}
      <img src="{{ data.avatar }}" alt="{{ data.username }}" class="w-14 h-14 rounded-full border-2 border-dark-border-light">
      {% else %}
      <div class="w-14 h-14 rounded-full bg-dark-card-alt flex items-center justify-center border-2 border-dark-border-light">
        <span class="text-xl font-bold">{{ data.username[0]|upper }}</span>
      </div>
      {% endif %}

      <div>
        <h1 class="text-2xl font-bold gradient-text">{{ data.username }}</h1>
        <div class="flex flex-wrap gap-2 text-xs text-dark-text-muted">
          <span>Level {{ data.level }}</span>
          <span>‚Ä¢</span>
          <span>{{ data.build_type }} Build</span>
          {% if data.mu %}
          <span>‚Ä¢</span>
          <span class="flex flex-row"><img src="{{data.mu.avatar}}" alt="{{ data.mu.mu_name }}" title="{{ data.mu.mu_name }}" class="w-6 h-6">{{ data.mu.mu_name }}</span>
          {% endif %}
          <span>Last updated: {{data.last_updated}}</span>
        </div>

      </div>
    </div>

    <a href="https://app.warera.io/user/{{ data.user_id }}" target="_blank"
       class="text-xs uppercase tracking-wide text-dark-text-muted">
      View on Warera ‚Üí
    </a>
  </div>
</header>

    <div class="grid grid-cols-3 [grid-template-columns:repeat(auto-fit,minmax(160px,1fr))] gap-4 mb-8">
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Total Damage</div>
            <div class="text-xl font-bold">{{ "{:,.0f}".format(data.total_dmg) }}</div>
        </div>
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Wealth</div>
            <div class="text-xl font-bold text-accent-green">{{ "{:,.2f}".format(data.wealth) }}</div>
        </div>
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Bounty Collected</div>
            <div class="text-xl font-bold">{{ "{:,.2f}".format(data.bounty_collected) }}</div>
        </div>
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Companies</div>
            <div class="text-xl font-bold">{{ data.company_breakdown|length }}</div>
        </div>
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Daily Wage Earn</div>
            <div class="text-xl font-bold">{{ "{:,.2f}".format(data.job_breakdown.average_daily_wage_earn) }}</div>
        </div>
        <div class="bg-dark-card border border-dark-border rounded-xl p-4">
            <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Status</div>
            <div class="flex items-center gap-2">
                <span class="inline-block w-2 h-2 {% if data.is_active %}bg-accent-green{% else %}bg-dark-text-dim{% endif %} rounded-full"></span>
                <span class="text-sm font-semibold">{% if data.is_active %}Active{% else %}Inactive{% endif %}</span>
            </div>
        </div>
    </div>

    <!-- Skills Section -->
    <div class="bg-gradient-to-br from-dark-card-alt to-dark-card border border-dark-border-light rounded-2xl p-8 mb-10 relative overflow-hidden">
        <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-dark-text-dim to-transparent"></div>
        
        <h3 class="uppercase tracking-widest text-dark-text-dim mb-6 font-semibold">‚ö° Skills & Attributes</h3>
        
        <div class="grid [grid-template-columns:repeat(auto-fit,minmax(260px,1fr))] gap-4">
            <!-- Core Skills -->
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-3">‚öîÔ∏è Combat</div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Attack</span>
                        <span class="font-semibold">{{ data.skills.attack.total }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Critical Chance</span>
                        <span class="font-semibold">{{ data.skills.criticalChance.total }}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Critical Damage</span>
                        <span class="font-semibold">{{ data.skills.criticalDamages.total }}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Precision</span>
                        <span class="font-semibold">{{ data.skills.precision.total }}%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Armor</span>
                        <span class="font-semibold">{{ data.skills.armor.total }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Dodge</span>
                        <span class="font-semibold">{{ data.skills.dodge.total }}%</span>
                    </div>
                </div>
            </div>

            <!-- Resource Skills -->
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-3">üìä Resources</div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Energy</span>
                        <span class="font-semibold">{{ data.skills.energy.currentBarValue|round(1) }} / {{ data.skills.energy.total }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Health</span>
                        <span class="font-semibold">{{ data.skills.health.currentBarValue|round(1) }} / {{ data.skills.health.total }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-dark-text-muted">Hunger</span>
                        <span class="font-semibold">{{ data.skills.hunger.currentBarValue|round(1) }} / {{ data.skills.hunger.total }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Company Breakdown -->
    <div class="bg-dark-card border border-dark-border rounded-xl p-8 mb-10">
        <h2 class="text-base font-semibold uppercase tracking-wide mb-6">üè≠ Company Portfolio</h2>
        
        <!-- Summary Stats -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            {% set total_profit = namespace(value=0) %}
            {% set total_revenue = namespace(value=0) %}
            {% set total_production = namespace(value=0) %}
            {% set total_employees = namespace(value=0) %}
            
            {% for company in data.company_breakdown %}
                {% set total_profit.value = total_profit.value + company.stats.avg_daily_net_profit %}
                {% set total_revenue.value = total_revenue.value + company.stats.avg_daily_revenue_total %}
                {% set total_production.value = total_production.value + company.stats.avg_daily_total_pp %}
                {% set total_employees.value = total_employees.value + company.workers|length %}
            {% endfor %}
            
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Total Potential Daily Profit</div>
                <div class="text-xl font-bold text-accent-green">{{ "{:,.2f}".format(total_profit.value) }}</div>
            </div>
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Total Potential Daily Revenue</div>
                <div class="text-xl font-bold">{{ "{:,.2f}".format(total_revenue.value) }}</div>
            </div>
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Total Daily Production Points Generated</div>
                <div class="text-xl font-bold">{{ "{:,.0f}".format(total_production.value) }}</div>
            </div>
            <div class="bg-dark-bg border border-dark-border rounded-lg p-4">
                <div class="text-xs text-dark-text-dim uppercase tracking-wider mb-1">Employees</div>
                <div class="text-xl font-bold">{{ total_employees.value }}</div>
            </div>
        </div>

        <!-- Individual Companies -->
<div class="grid grid-cols-1 [grid-template-columns:repeat(auto-fit,minmax(320px,1fr))] gap-4">
    {% for company in data.company_breakdown %}
        <div class="bg-dark-card border border-dark-card-alt rounded-lg p-3.5 mb-3 border-l-4 border-t-white {% if company.has_workers %}border-l-accent-green{% else %}border-l-accent-gray{% endif %}">
            
            <!-- Company Header -->
            <div class="flex items-center gap-2 mb-3 pb-3 border-b border-dark-card-alt text-sm">
                <img src="{{ url_for('static', filename=item_icons[company.company.itemCode]) }}" alt="{{ company.company.itemCode }}" title="{{ company.company.itemCode }}" class="w-6 h-6">
                <p class="uppercase font-bold">{{ company.company.name }}</p>
                <small class="ml-auto">Current Market Value at:  =  BTC</small>
            </div>

            <!-- Avg Revenue / Wages / Profit -->
            <div class="grid grid-cols-3 gap-3 py-3 mb-3 border-b border-dark-card-alt">
                <span class="flex flex-col gap-1 text-xs text-dark-text-dim uppercase tracking-wide">
                    Avg Daily Revenue
                    <strong class="text-accent-green text-sm normal-case tracking-normal">{{ "%.2f"|format(company.stats.avg_daily_revenue_total) }} BTC</strong>
                </span>
                <span class="flex flex-col gap-1 text-xs text-dark-text-dim uppercase tracking-wide">
                    Avg Daily Wages
                    <strong class="text-accent-red text-sm normal-case tracking-normal">{{ "%.2f"|format(company.stats.avg_daily_wages_paid) }} BTC</strong>
                </span>
                <span class="flex flex-col gap-1 text-xs text-dark-text-dim uppercase tracking-wide">
                    Avg Potential Daily Profit
                    <strong class="text-accent-green text-sm normal-case tracking-normal">{{ "%.2f"|format(company.stats.avg_daily_net_profit) }} BTC</strong>
                </span>
            </div>

            <!-- Production Points / Units -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 py-3 mb-3 border-b border-dark-card-alt">
                <div class="text-xs text-dark-text-dim">
                    <div class="mb-2">Avg Daily Production Points</div>
                    <div class="text-dark-text-muted text-[10px]">From Workers: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_employee_prod) }} ‚ö°</strong></div>
                    <div class="text-dark-text-muted text-[10px]">From Self Work: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_self_work) }} ‚õèÔ∏è</strong></div>
                    <div class="text-dark-text-muted text-[10px]">From Automation: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_automation_engine) }} ‚öôÔ∏è</strong></div>
                    <div class="text-dark-text text-xs mt-1">Total: <strong>{{ "%.2f"|format(company.stats.avg_daily_total_pp) }} PP/day üí∏</strong></div>
                </div>
                <div class="text-xs text-dark-text-dim">
                    <div class="mb-2">Avg Daily Units Produced</div>
                    <div class="text-dark-text-muted text-[10px]">From Workers: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_units_employee) }} ‚ö°</strong></div>
                    <div class="text-dark-text-muted text-[10px]">From Self Work: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_units_self_work) }} ‚õèÔ∏è</strong></div>
                    <div class="text-dark-text-muted text-[10px]">From Automation: <strong class="text-dark-text">{{ "%.2f"|format(company.stats.avg_daily_units_automation) }} ‚öôÔ∏è</strong></div>
                    <div class="text-dark-text text-xs mt-1">Total: <strong>{{ "%.2f"|format(company.stats.avg_daily_units_total) }} units/day üí∏</strong></div>
                </div>
            </div>

            <!-- Revenue split -->
            <div class="grid grid-cols-3 gap-3 text-xs text-dark-text-dim">
                <div>From Workers<div class="text-dark-text font-semibold text-xs mt-1">{{ "%.2f"|format(company.stats.avg_daily_units_employee) }} BTC/day</div></div>
                <div>From Self Work<div class="text-dark-text font-semibold text-xs mt-1">{{ "%.2f"|format(company.stats.avg_daily_units_self_work) }} BTC/day</div></div>
                <div>From Automation<div class="text-dark-text font-semibold text-xs mt-1">{{ "%.2f"|format(company.stats.avg_daily_units_automation) }} BTC/day</div></div>
                <div class="text-dark-text text-xs mt-1">Total: <strong>{{ "%.2f"|format(company.stats.avg_daily_units_total) }} units/day üí∏</strong></div>
            </div>

            {% if company.workers %}
                <!-- Workers Section -->
                <div class="text-xs uppercase tracking-widest text-dark-text-dim mt-4 mb-2.5 font-semibold">Workers ({{ company.workers|length }})</div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2.5 mt-2">
                    {% for worker in company.workers %}
                        <div class="bg-dark-bg border border-dark-border rounded-md p-2.5">
                            <div class="font-semibold text-sm mb-2 pb-2 border-b border-dark-card-alt">Worker Name: {{ worker.name }}</div>
                            <div class="text-xs text-dark-text-muted mb-1">Current Wage: <strong class="text-dark-text">{{ "%.2f"|format(worker.wage) }}</strong> BTC</div>
                            <div class="text-xs text-dark-text-muted mb-1">Energy: <strong class="text-dark-text">{{ "%.2f"|format(worker.energy) }} ‚ö°</strong></div>
                            <div class="text-xs text-dark-text-muted mb-1">Production: <strong class="text-dark-text">{{ "%.2f"|format(worker.production) }} ‚õèÔ∏è</strong></div>
                            <div class="text-xs text-dark-text-muted mb-1">Fidelity Level: <strong class="text-dark-text">{{ "%.2f"|format(worker.fidelity) }} üíõ</strong></div>
                            <div class="text-xs text-dark-text-muted">Joined: <strong class="text-dark-text">{{ worker.joinedAt }}</strong></div>

                            <div class="text-dark-text-muted text-xs mb-2 mt-4">Daily Averages</div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 py-3 mb-3 border-b border-dark-card-alt">
                                <div class="text-dark-text-muted text-[10px]">Production Points: <strong class="text-dark-text">{{ "%.2f"|format(worker.stats.avg_daily_production_points) }}</strong> PP/day ‚õèÔ∏è</div>
                                <div class="text-dark-text-muted text-[10px]">Units Produced: <strong class="text-dark-text">{{ "%.2f"|format(worker.stats.avg_daily_units_produced) }}</strong> units/day</div>
                                <div class="text-dark-text-muted text-[10px]">Revenue Generated: <strong class="text-accent-green">{{ "%.2f"|format(worker.stats.avg_potential_daily_revenue) }}</strong> BTC/day</div>
                                <div class="text-dark-text-muted text-[10px]">Wage Expenditure: <strong class="text-accent-red">{{ "%.2f"|format(worker.stats.avg_daily_wage_expenditure) }}</strong> BTC/day</div>
                                <div class="text-dark-text-muted text-[10px]">Net Profit: <strong class="text-accent-green">{{ "%.2f"|format(worker.stats.avg_daily_net_profit) }}</strong> BTC/day</div>
                                <div class="text-dark-text-muted text-[10px]">Profit Margin: <strong class="text-dark-text">{{ "%.2f"|format(worker.stats.avg_daily_profit_margin) }}%</strong></div>
                                <div class="text-dark-text-muted text-[10px]">Break-even Price: <strong class="text-dark-text">{{ "%.2f"|format(worker.stats.break_even_price) }}</strong> BTC/unit</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>
    </div>

{% endblock %}

{% block scripts %}
{% endblock %}